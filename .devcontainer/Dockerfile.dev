FROM mcr.microsoft.com/devcontainers/python:1-3.12-bullseye

# Avoid prompts during package installation
ARG DEBIAN_FRONTEND=noninteractive

# Install additional packages
RUN apt-get update && apt-get install -y --no-install-recommends \
    libpq-dev \
    curl \
    wget \
    procps \
    && rm -rf /var/lib/apt/lists/*

# Install Supabase CLI
RUN curl -fsSL https://get.supabase.io/apt | bash \
    && apt-get update \
    && apt-get install -y supabase \
    && rm -rf /var/lib/apt/lists/*

# Install UV for package management
RUN curl -fsSL https://astral.sh/uv/install.sh | bash \
    && mv ~/.cargo/bin/uv /usr/local/bin/ \
    && chmod +x /usr/local/bin/uv

# Make sure entrypoint script is executable
RUN echo "#!/bin/bash\n\n# Execute passed CMD\nexec \"\$@\"" > /usr/local/bin/entrypoint.sh \
    && chmod +x /usr/local/bin/entrypoint.sh

# Switch to vscode user is done automatically by the base image

ENTRYPOINT ["/usr/local/bin/entrypoint.sh"]
CMD ["sleep", "infinity"]